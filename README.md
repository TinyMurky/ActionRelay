# ActionRelay

> [!link] This project is based on or inspired by the following repositories:
>
> - [catchpoint/workflow-telemetry-action](https://github.com/catchpoint/workflow-telemetry-action/tree/master)
> - [yogeshlonkar/wait-for-jobs](https://github.com/yogeshlonkar/wait-for-jobs/tree/main)
>
> Please Check [License](./LICENSE) for more information

## Description

> [!warning] report chart will not include the job that run ActionRelay, please
> put ActionRelay in sibling job.

- **Original Purpose**: ActionRelay originally want send Info to flutter App via
  middle relay server
- **v0.0.1**: In `v0.0.1`, Action Relay can gather started and completed time of
  jobs and steps of pull request, and comment of Gantt Chart base on range
  between started and completed time.

## Inputs

### `NAME_OF_THIS_JOB`

Provide the `name` of the current job (e.g., if `name: Run Action Relay` is used
in the workflow, input `Run Action Relay` here).  
This input is used to filter out the job where ActionRelay is running to prevent
it from waiting for itself to complete, which could cause an infinite loop.

**Required:** Yes

---

### `GITHUB_TOKEN`

Provide the value `${{ secrets.GITHUB_TOKEN }}` exactly as shown. GitHub will
automatically recognize this and generate a unique token for the current run.

**Required:** Yes

---

### `TIMEOUT_AFTER_MINUTE`

ActionRelay will wait for other jobs to complete before executing.  
`TIMEOUT_AFTER_MINUTE` sets the maximum wait time in minutes. If the timeout is
reached, ActionRelay will proceed to the reporting process.  
If the value exceeds 15 minutes, it will be constrained to 15 minutes.

**Required:** Yes  
**Default:** '15'

---

### `INTERVAL_TO_CHECK_JOBS`

ActionRelay will periodically fetch the GitHub API to check the status of other
jobs while waiting for them to complete.  
`INTERVAL_TO_CHECK_JOBS` sets the interval (in milliseconds) between each API
fetch.

**Required:** Yes  
**Default:** '2500'

---

## Outputs

### `time`

The time this action finished

## Usage

> [!note]
>
> - `${{ secrets.GITHUB_TOKEN }}` will be auto generated by github, so just use
>   literally `${{ secrets.GITHUB_TOKEN }}`

```yaml
permissions:
  pull-requests: write
jobs:
  run_action_relay:
    name: Run Action Relay
    runs-on: ubuntu-latest

    steps:
      - name: ActionRelay
        id: action-relay
        uses: Tiny_Murky/ActionRelay
        with:
          NAME_OF_THIS_JOB: Run Action Relay
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          TIMEOUT_AFTER_MINUTE: '15'
          INTERVAL_TO_CHECK_JOBS: '2500'
      - name: other step
        id: other-step
        uses: xxxxx
```
